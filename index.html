<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç ‡∏°.2/1</title>
    <script defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header { text-align: center; padding: 20px; }
        .school-logo { width: 120px; height: auto; filter: drop-shadow(0 0 8px rgba(255,255,255,0.2)); }
        
        /* Camera Container */
        .webcam-container {
            position: relative;
            width: 90%;
            max-width: 500px;
            aspect-ratio: 4/3;
            background: #1e1e1e;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #bb86fc;
            box-shadow: 0 0 20px rgba(187, 134, 252, 0.3);
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Status Display */
        .status-box {
            background: #2c2c2c;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            border: 1px solid #333;
        }

        #emotion-result {
            font-size: 2rem;
            color: #bb86fc;
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }

        .loading-text { color: #888; font-size: 0.9rem; }
    </style>
</head>
<body>

    <header>
        <img src="https://img2.pic.in.th/logo-253x300-1.png" alt="School Logo" class="school-logo">
        <h1 style="font-size: 1.4rem;">‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‡∏°.2/1</h1>
    </header>

    <div class="webcam-container">
        <video id="video" autoplay muted playsinline></video>
        </div>

    <div class="status-box">
        <span class="loading-text" id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö AI...</span>
        <div id="emotion-result">‡∏£‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡πä‡∏ö‡∏ô‡∏∞...</div>
    </div>

    <script>
        const video = document.getElementById('video');
        const statusText = document.getElementById('status');
        const emotionResult = document.getElementById('emotion-result');

        // ‡πÅ‡∏õ‡∏•‡∏ú‡∏•‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        const emotionThai = {
            neutral: "‡πÄ‡∏â‡∏¢‡πÜ üòê",
            happy: "‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏à‡∏±‡∏á! üòä",
            sad: "‡∏î‡∏π‡πÄ‡∏®‡∏£‡πâ‡∏≤‡πÜ ‡∏ô‡∏∞ üò¢",
            angry: "‡πÇ‡∏Å‡∏£‡∏ò‡πÉ‡∏Ñ‡∏£‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤? üò†",
            fearful: "‡∏î‡∏π‡∏ï‡∏Å‡πÉ‡∏à‡∏ô‡∏∞ üò®",
            disgusted: "‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ ü§¢",
            surprised: "‡∏ß‡πâ‡∏≤‡∏ß! ‡∏õ‡∏£‡∏∞‡∏´‡∏•‡∏≤‡∏î‡πÉ‡∏à üò≤"
        };

        // 1. ‡πÇ‡∏´‡∏•‡∏î Models ‡∏à‡∏≤‡∏Å CDN
        async function loadModels() {
            const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/';
            await Promise.all([
                faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),
                faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL)
            ]);
            startVideo();
        }

        // 2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
        function startVideo() {
            navigator.mediaDevices.getUserMedia({ video: {} })
                .then(stream => {
                    video.srcObject = stream;
                    statusText.innerText = "‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
                })
                .catch(err => {
                    statusText.innerText = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err;
                });
        }

        // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏ö‡∏ö Real-time
        video.addEventListener('play', () => {
            setInterval(async () => {
                const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();
                
                if (detections.length > 0) {
                    // ‡∏´‡∏≤‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                    const expressions = detections[0].expressions;
                    const maxValue = Math.max(...Object.values(expressions));
                    const mainEmotion = Object.keys(expressions).filter(item => expressions[item] === maxValue);
                    
                    emotionResult.innerText = emotionThai[mainEmotion[0]] || mainEmotion[0];
                } else {
                    emotionResult.innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ üë§";
                }
            }, 500); // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å‡πÜ 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        });

        loadModels();
    </script>
</body>
</html>
